<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Ariya charge % calculator</title>

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="EV % Calc">
<meta name="theme-color" content="#ffffff">
<meta name="color-scheme" content="light dark">

<style>
  :root { --pad:14px; --radius:12px; --font: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji"; }
  html { -webkit-text-size-adjust: 100%; }
  body { font-family: var(--font); margin:0; padding:0; background:#f6f7f9; color:#0f172a; }
  .wrap { max-width:680px; margin:40px auto; padding:0 var(--pad); }
  .card { background:#fff; border-radius:var(--radius); box-shadow:0 1px 3px rgba(0,0,0,.08),0 10px 24px rgba(0,0,0,.06); padding:calc(var(--pad)*1.25); transition:background .2s,color .2s,border-color .2s; }
  .card.danger { background:#b91c1c; color:#fff; }
  h1 { font-size:1.25rem; margin:0 0 12px; }

  .grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:12px; margin:10px 0 6px; }
  label { display:block; font-weight:600; font-size:.9rem; margin-bottom:6px; }
  input[type="number"]{
    width:100%; font-size:16px; padding:6px 8px;
    border:1px solid #cbd5e1; border-radius:6px; outline:none;
    background:#fff; color:#0f172a; -webkit-appearance:none; appearance:none;
  }
  .card.danger input[type="number"]{ background:#fee2e2; border-color:#fecaca; color:#7f1d1d; }
  input[type="number"]:focus{ border-color:#64748b; }
  .muted{ color:#64748b; font-size:.9rem; }
  .card.danger .muted{ color:#fde68a; }

  .result{ margin-top:18px; padding:18px; background:#f1f5f9; border-radius:12px; text-align:center; }
  .card.danger .result{ background:rgba(255,255,255,.12); }
  .result .big{ font-size:2rem; line-height:1.2; }
  .result .big strong{ font-weight:800; }
  .warn{ margin-top:8px; font-size:.95rem; text-align:center; display:none; }
  .card.danger .warn{ display:block; font-weight:700; }

  /* Efficiency block */
  .eff{ margin-top:12px; padding:12px; background:#f8fafc; border:1px solid #e2e8f0; border-radius:10px; }
  .card.danger .eff{ background:rgba(255,255,255,.12); border-color:rgba(255,255,255,.25); }
  .inline{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
  .chip{ border:1px solid #cbd5e1; border-radius:999px; padding:6px 10px; background:#fff; font-weight:600; cursor:pointer; }
  .chip:active{ transform:translateY(1px); }
  .card.danger .chip{ background:#fff; color:#7f1d1d; }

  /* Desktop: keep inputs compact */
  @media (min-width:768px){ input[type="number"]{ max-width:140px; display:inline-block; } }

  /* Tic-Tac-Toe */
  .ttt { margin-top:16px; padding:12px; background:#f8fafc; border:1px solid #e2e8f0; border-radius:10px; }
  .card.danger .ttt { background:rgba(255,255,255,.12); border-color:rgba(255,255,255,.25); }
  .ttt h2 { margin:0 0 6px; font-size:1rem; }
  .ttt .note { margin:0 0 10px; font-size:.9rem; color:#475569; }
  .card.danger .ttt .note { color:#fde68a; }
  .board {
    display:grid; grid-template-columns:repeat(3, 64px); grid-template-rows:repeat(3, 64px);
    gap:6px; justify-content:center; margin:10px 0;
  }
  .cell {
    width:64px; height:64px; border:1px solid #cbd5e1; border-radius:10px; background:#fff;
    font-size:1.5rem; font-weight:800; color:#111; /* darker text */
    display:flex; align-items:center; justify-content:center;
    cursor:pointer; user-select:none;
  }
  .cell:active { transform: translateY(1px); }
  .card.danger .cell { background:#fff; color:#111; }
  .ttt-controls { display:flex; gap:10px; justify-content:center; align-items:center; margin-top:6px; flex-wrap:wrap; }
  .btn { border:1px solid #cbd5e1; background:#fff; padding:8px 12px; border-radius:10px; font-weight:600; cursor:pointer; }
  .btn:active { transform: translateY(1px); }
  .status { text-align:center; margin-top:6px; font-weight:600; }
</style>
</head>
<body>
  <div class="wrap">
    <div class="card" id="card">
      <h1>Ariya Charge % Calculator</h1>

      <div class="grid">
        <div>
          <label for="miles">Trip distance (miles)</label>
          <input type="number" id="miles" placeholder="e.g., 120" min="0" step="1" inputmode="numeric">
        </div>
        <div>
          <label for="buffer">Arrival range (miles)</label>
          <input type="number" id="buffer" value="10" min="0" step="1" inputmode="numeric">
          <div class="muted">Recommended minimum: 10 miles.</div>
        </div>
      </div>

      <div class="result" id="out" aria-live="polite">
        <span class="big">Charge to <strong id="pct">--%</strong></span>
        <div class="warn" id="cap">Unable to make trip at 100%.</div>
      </div>

      <!-- Efficiency control -->
      <div class="eff">
        <label for="eff">Planning efficiency (miles per 1%)</label>
        <div class="inline">
          <input type="number" id="eff" value="2.5" min="1.0" max="4.0" step="0.05" inputmode="decimal">
          <button class="chip" data-eff="2.5" title="Observed">2.5 observed</button>
          <button class="chip" data-eff="2.25" title="Conservative">2.25 conservative</button>
        </div>
        <div class="muted">Default 2.5. Use 2.25 for conservative planning.</div>
      </div>

      <!-- Tic-Tac-Toe -->
      <div class="ttt">
        <h2>Tic-Tac-Toe</h2>
        <div class="note">Play tic-tac-toe while charging if youâ€™re bored.</div>
        <div class="board" id="board" aria-label="Tic Tac Toe board"></div>
        <div class="status" id="ttt-status">X to move</div>
        <div class="ttt-controls">
          <button class="btn" id="ttt-new">New Game</button>
          <label class="inline" style="gap:6px;">
            <input type="checkbox" id="ttt-vsai"> Check box to play against phone
          </label>
        </div>
      </div>

    </div>
  </div>

<script>
(function(){
  // ===== Calculator logic =====
  const miles  = document.getElementById('miles');
  const buffer = document.getElementById('buffer');
  const pctOut = document.getElementById('pct');
  const card   = document.getElementById('card');
  const cap    = document.getElementById('cap');
  const effInp = document.getElementById('eff');
  const chips  = document.querySelectorAll('.chip');

  const saved = JSON.parse(localStorage.getItem('ariyacalc') || '{}');
  if (saved.miles  != null) miles.value  = saved.miles;
  if (saved.buffer != null) buffer.value = saved.buffer; else buffer.value = 10;
  if (saved.eff    != null) effInp.value = saved.eff;    else effInp.value = 2.5;

  function compute(){
    const m   = (miles.value === "" ? NaN : Number(miles.value));
    const buf = Number(buffer.value || 0);
    const eff = Number(effInp.value || 2.5);

    localStorage.setItem('ariyacalc', JSON.stringify({ miles: (isNaN(m) ? "" : m), buffer: buf, eff }));

    if (isNaN(m)) {
      pctOut.textContent = "--%";
      card.classList.remove('danger');
      cap.style.display = "none";
      return;
    }

    let pct = (m + buf) / eff;
    pct = Math.ceil(pct);
    const exceeds = pct > 100;

    pctOut.textContent = pct + "%";
    if (exceeds) { card.classList.add('danger'); cap.style.display = "block"; }
    else { card.classList.remove('danger'); cap.style.display = "none"; }
  }

  [miles, buffer, effInp].forEach(el => el.addEventListener('input', compute));
  chips.forEach(btn => btn.addEventListener('click', () => { effInp.value = btn.dataset.eff; compute(); }));
  compute();

  // ===== Tic-Tac-Toe =====
  const boardEl = document.getElementById('board');
  const statusEl = document.getElementById('ttt-status');
  const newBtn = document.getElementById('ttt-new');
  const vsAi = document.getElementById('ttt-vsai');

  let board = Array(9).fill(null);
  let turn = 'X';
  let gameOver = false;

  const lines = [
    [0,1,2],[3,4,5],[6,7,8],
    [0,3,6],[1,4,7],[2,5,8],
    [0,4,8],[2,4,6]
  ];

  function renderBoard(){
    boardEl.innerHTML = '';
    board.forEach((val, i) => {
      const btn = document.createElement('button');
      btn.className = 'cell';
      btn.setAttribute('aria-label', `Cell ${i+1}`);
      btn.textContent = val ? val : '';
      btn.disabled = !!val || gameOver;
      btn.addEventListener('click', () => move(i));
      boardEl.appendChild(btn);
    });
  }

  function winner(b){
    for (const [a,c,d] of lines){
      if (b[a] && b[a] === b[c] && b[a] === b[d]) return b[a];
    }
    return null;
  }

  function emptySquares(b){ return b.map((v,i)=>v?null:i).filter(i=>i!==null); }

  function bestAiMove(){
    const me = 'O', opp = 'X';
    const empties = emptySquares(board);
    for (const i of empties){ const test = board.slice(); test[i] = me; if (winner(test) === me) return i; }
    for (const i of empties){ const test = board.slice(); test[i] = opp; if (winner(test) === opp) return i; }
    if (board[4] === null) return 4;
    const corners = [0,2,6,8].filter(i => board[i] === null);
    if (corners.length) return corners[Math.floor(Math.random()*corners.length)];
    return empties[Math.floor(Math.random()*empties.length)];
  }

  function move(i){
    if (gameOver || board[i]) return;
    board[i] = turn;
    const w = winner(board);
    if (w){ statusEl.textContent = `${w} wins!`; gameOver = true; renderBoard(); return; }
    if (emptySquares(board).length === 0){ statusEl.textContent = `It's a draw.`; gameOver = true; renderBoard(); return; }
    turn = (turn === 'X') ? 'O' : 'X';
    statusEl.textContent = `${turn} to move`;
    renderBoard();
    if (!gameOver && vsAi.checked && turn === 'O'){
      setTimeout(() => { const ai = bestAiMove(); if (ai !== undefined){ move(ai); } }, 200);
    }
  }

  function resetGame(){
    board = Array(9).fill(null);
    turn = 'X';
    gameOver = false;
    statusEl.textContent = 'X to move';
    renderBoard();
  }

  newBtn.addEventListener('click', resetGame);
  vsAi.addEventListener('change', resetGame);
  renderBoard();

})();
</script>
</body>
</html>
